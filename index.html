<html>
<head>
    <title>Dawn of Worlds</title>
</head>
<body>
<style>
    body {
        background-color: lightgrey;
    }
    #gridTable th, #gridTable td {
        border: 1px solid lightblue;
        height: 40px;
        width: 40px;
        /*padding: 15px;*/
        font-family: "Courier New";
        text-align: center;
        color: darkblue;
        font-weight: bold;
        font-size: 18px;
    }
    th, td {
        border: 1px solid black;
        height: 40px;
        width: 40px;
        /*padding: 15px;*/
        font-family: "Courier New";
        text-align: center;
        /*color: darkblue;*/
        font-weight: bold;
        font-size: 18px;
    }
    .legend {
        color: black;
        font-weight: bold;
        /*text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;*/
    }
</style>

<table>
    <tr>
        <th>Preview</th>
        <th>Icon</th>
        <th>Color 1</th>
        <th id="color2Header" style="display: none;">Color 2</th>
        <th id="degreesHeader" style="display: none;">Degrees</th>
    </tr>
    <tr>
        <td id="previewBox"></td>
        <td id="chosenIcon" onclick="setInputType('icon')"></td>
        <td id="chosenColor1" onclick="setPrimaryColor(1);"></td>
        <td id="chosenColor2" onclick="setPrimaryColor(2);" style="display: none;"></td>
        <td id="degreesBox" style="display: none; width: 50px;"><input type="text" name="Degree_String" id="chosenDegrees" onBlur="setDegrees()" maxlength="3" style="width: 50px;"></td>
        <td id="showMultipleColorOptions"><input type="button" value="Advanced" onclick="showHideMultipleColorOptions()"></td>

    </tr>
</table>

<table>
    <tr>
        <td><input type="button" value="Add Color" onclick="toggleTools('color')"></td>
        <td><input type="button" value="Add Icon" onclick="toggleTools('icon')"></td>
        <td><input type="button" value="Point Costs" onclick="toggleTools('points')"></td>
        <td><input type="button" value="Map Options" onclick="toggleTools('map')"></td>
        <td><input type="button" value="Import/Export" onclick="toggleTools('export')"></td>
    </tr>
</table>

<table id="colorTools" style="display: none;">
    <tr onclick="setInputType('color');">
        <td style="background-color: green;" onclick="setColor('green')" class="legend">Forest</td>
        <td style="background-color: yellow;" onclick="setColor('yellow');" class="legend">Desert</td>
        <td style="background-color: white;" onclick="setColor('white');" class="legend">Snow</td>
        <td style="background-color: deepskyblue;" onclick="setColor('deepskyblue');" class="legend">Water</td>
        <td style="background-color: lightgreen;" onclick="setColor('lightgreen');" class="legend">Plains</td>
        <td style="background-color: saddlebrown;" onclick="setColor('saddlebrown');" class="legend">Mountains</td>
    </tr>
    <tr onclick="setInputType('color');">
        <td onclick="setColor('');" class="legend">Remove</td>
        <td colspan="5"><input type="text" name="Color_String" id="colorString" onBlur="setColor('#' + this.value);" maxlength="6" placeholder="ex CFCFCF"></td>
    </tr>
</table>

<table id="iconTools" style="display: none;">
    <tr onclick="setInputType('icon');">
        <td onclick="setIcon('&#x1F332;');" class="legend">&#x1F332;</td>
        <td onclick="setIcon('&#x1F335;');" class="legend">&#x1F335;</td>
        <td onclick="setIcon('&#x2744;');" class="legend">&#x2744;</td>
        <td onclick="setIcon('&#x1F30A;');" class="legend">&#x1F30A;</td>
        <td onclick="setIcon('&#x1F33E;');" class="legend">&#x1F33E;</td>
        <td onclick="setIcon('&#x1F5FB;');" class="legend">&#x1F5FB;</td>
    </tr>
    <tr onclick="setInputType('icon');">
        <td onclick="setIcon('&#x1F42F;');" class="legend">&#x1F42F;</td>
        <td onclick="setIcon('&#x1F418;');" class="legend">&#x1F418;</td>
        <td onclick="setIcon('&#x1F9DA;');" class="legend">&#x1F9DA;</td>
        <td onclick="setIcon('&#x1F40E;');" class="legend">&#x1F40E;</td>
        <td onclick="setIcon('&#x1F98C;');" class="legend">&#x1F98C;</td>
        <td onclick="setIcon('&#x1F402;');" class="legend">&#x1F402;</td>
    </tr>
    <tr onclick="setInputType('icon');">
        <td onclick="setIcon('&#x26FA;');" class="legend">&#x26FA;</td>
        <td onclick="setIcon('&#x1F3E0;');" class="legend">&#x1F3E0;</td>
        <td onclick="setIcon('&#x1F3E1;');" class="legend">&#x1F3E1;</td>
        <td onclick="setIcon('&#x1F3ED;');" class="legend">&#x1F3ED;</td>
        <td onclick="setIcon('&#x1F3F0;');" class="legend">&#x1F3F0;</td>
        <td onclick="setIcon('&#x1F3E2;');" class="legend">&#x1F3E2;</td>
    </tr>
    <tr onclick="setInputType('icon');">
        <td onclick="setIcon('');" class="legend">Remove</td>
        <td colspan="3"><input type="text" name="Icon_String" id="iconString" onBlur="setIcon('&#x' + this.value + ';');" maxlength="6" placeholder="ex 1F981"  style="width: 70px;"></td>
        <td colspan="2"><input type="text" name="Icon_String2" id="iconString2" onBlur="setIcon(this.value);" maxlength="1" placeholder="ex &#x1F981;" style="width: 50px;"></td>
    </tr>
</table>

<table id="mapTools" style="display: none;">
    <tr>
        <th>Map Location</th>
        <th>Column Count</th>
        <th>Row Count</th>
    </tr>
    <tr>
        <td><input type="file" name="Map" id="map" onChange="readURL(this);"/></td>
        <td><input type="text" name="Column_String" id="columnString" onBlur="setColumns()"></td>
        <td><input type="text" name="Row_String" id="rowString" onBlur="setRows()"></td>

    </tr>
</table>

<table id="exportTools" style="display: none;">
    <tr>
        <th>Import/Export String</th>
    </tr>
    <tr>
        <td style="width: 800px;">
            <input type="text" name="Input_String" id="inputString" onBlur="importString()" style="width: 100%;">
        </td>
    </tr>
</table>

<div id="pointsTools" style="display: none;"></div>

<div id="grid"></div>

</div>
<script>
    //var biome = '';
    var inputType = '';
    var color1 = '';
    var color2 = '';
    var degrees = '90';
    var primaryColor = 1;
    var icon = '';
    var changeLog = {};
    var newChangeLog = {};
    var columnCount = 36;
    var rowCount = 26;
    var columnNames = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'aa', 'bb', 'cc', 'dd', 'ee', 'ff', 'gg', 'hh', 'ii', 'jj', 'kk', 'll', 'mm', 'nn', 'oo', 'pp', 'qq', 'rr', 'ss', 'tt', 'uu', 'vv', 'ww', 'xx', 'yy', 'zz'];
    //var powerNames2 = ['Shape Land, 1"', 'Shape Climate, 1"', 'Create Race', 'Create Subrace', 'Command Race**', 'Command City**', 'Advance Civilization', 'Advance City', 'Purify Civilization, +1 Alignment*', 'Corrupt Civilization, -1 Alignment*', 'Purify City, +1 Alignment*', 'Corrupt City, -1 Alignment*', 'Event', 'Create Order', 'Command Order', 'Create Avatar', 'Command Avatar', 'Catastrophe, 1"'];
    var powerNames = [{'Shape Land, 1"' : [3, 5, 8]}, {'Shape Climate, 1"' : [2, 4, 6]}, {'Create Race' : [22, 6, 15]}, {'Create Subrace' : [12, 4, 10]}, {'Command Race**' : [8, 4, 3]}, {'Command City**' : [6, 4, 2]}, {'Advance Civilization' : [10, 5, 6]}, {'Advance City' : [8, 4, 5]}, {'Purify Civilization, +1 Alignment*' : [5, 3, 4]}, {'Corrupt Civilization, -1 Alignment*' : [4, 3, 3]}, {'Purify City, +1 Alignment*' : [4, 3, 3]}, {'Corrupt City, -1 Alignment*' : [3, 2, 2]}, {'Event' : [10, 7, 9]}, {'Create Order' : [8, 6, 4]}, {'Command Order': [4, 3, 2]}, {'Create Avatar' : [10, 7, 8]}, {'Command Avatar' : [2, 1, 1]}, {'Catastrophe, 1"' : [10, 10, 10]}];
    var currentAge = 2;



    function displayCurrentToolset() {
        document.getElementById('chosenColor1').style.background = this.color1;
        document.getElementById('chosenColor2').style.background = this.color2;
        document.getElementById('chosenDegrees').value = this.degrees;
        document.getElementById('chosenIcon').innerHTML = this.icon;
        document.getElementById('chosenColor1').style.borderColor = '';
        document.getElementById('chosenColor2').style.borderColor = '';
        document.getElementById('chosenIcon').style.borderColor = '';

        if (this.inputType == 'color') {

            document.getElementById('chosenColor' + this.primaryColor).style.borderColor = '9ecaed';
            document.getElementById('previewBox').innerHTML = '';

            if (this.color2 == '' || this.color == this.color2) {
                document.getElementById('previewBox').style.background = this.color1;
            } else if (this.color1 == '' && this.color2 != '') {
                document.getElementById('previewBox').style.background = this.color2;
            } else {
                document.getElementById('previewBox').style.background = 'linear-gradient(' + this.degrees + 'deg, ' + this.color1 + ' 50%, ' + this.color2 + ' 50%)';
            }

        }

        if (this.inputType == 'icon') {
            document.getElementById('chosenIcon').style.borderColor = '9ecaed';
            document.getElementById('previewBox').style.background = '';
            document.getElementById('previewBox').innerHTML = this.icon;
        }

        document.getElementById('inputString').value = JSON.stringify(this.changeLog);

    }
    function setColor(choice) {
        if (this.primaryColor == 1) {
            this.color1 = choice;
        } else {
            this.color2 = choice;
        }

        displayCurrentToolset();
    }
    function setIcon(choice) {
        this.icon = choice;
        displayCurrentToolset();
    }
    function setInputType(choice) {
        this.inputType = choice;
        displayCurrentToolset();
    }
    function setColumns() {
        var columnValue = document.getElementById('columnString').value;
        if (columnValue > 52) {
            columnValue = 52;
        }
        this.columnCount = columnValue;
        //readURL(document.getElementById('map'));
        renderTableGrid();
        importString();
    }
    function setRows() {
        var rowValue = document.getElementById('rowString').value;
        if (rowValue > 52) {
            rowValue = 52;
        }
        this.rowCount = rowValue;
        //readURL(document.getElementById('map'));
        renderTableGrid();
        importString();
    }
    function setDegrees() {
        var degrees = document.getElementById('chosenDegrees').value;
        if (degrees > 360) {
            degrees = 360;
        }

        this.degrees = degrees;

        displayCurrentToolset();
    }
    function setPrimaryColor(number) {
        this.primaryColor = number;

        setInputType('color');

        displayCurrentToolset();
    }
    function showHideMultipleColorOptions() {
        document.getElementById('degreesHeader').style.display = '';
        document.getElementById('color2Header').style.display = '';
        document.getElementById('degreesBox').style.display = '';
        document.getElementById('chosenColor2').style.display = '';
        document.getElementById('showMultipleColorOptions').style.display = 'none';
    }
    function toggleTools(choice) {
        var current = document.getElementById(choice + 'Tools').style.display;

        document.getElementById('colorTools').style.display = 'none';
        document.getElementById('iconTools').style.display = 'none';
        document.getElementById('pointsTools').style.display = 'none';
        document.getElementById('mapTools').style.display = 'none';
        document.getElementById('exportTools').style.display = 'none';
        document.getElementById(choice + 'Tools').style.display = '';

        if (current != 'none') {
            document.getElementById(choice + 'Tools').style.display = 'none';
        }
    }
    function addToCell(coordinates) {

        if (!this.changeLog[coordinates]) {
            this.changeLog[coordinates] = {};
        }

        if (this.inputType == 'color') {

            if (this.color2 == '' || this.color == this.color2) {
                this.changeLog[coordinates].color1 = this.color1;
                document.getElementById(coordinates).style.background = this.color1;
            } else if (this.color1 == '' && this.color2 != '') {
                this.changeLog[coordinates].color1 = this.color2;
                document.getElementById(coordinates).style.background = this.color2;
            } else {
                this.changeLog[coordinates].color1 = this.color1;
                this.changeLog[coordinates].color2 = this.color2;
                this.changeLog[coordinates].degrees = this.degrees;
                document.getElementById(coordinates).style.background = 'linear-gradient(' + this.degrees + 'deg, ' + this.color1 + ' 50%, ' + this.color2 + ' 50%)';
            }


        }

        if (this.inputType == 'icon') {
            this.changeLog[coordinates].icon = this.icon;
            document.getElementById(coordinates).innerHTML = this.icon;
        }

        document.getElementById('inputString').value = JSON.stringify(this.changeLog);
    }
    function importString() {

        var string = document.getElementById('inputString').value;
        this.changeLog = JSON.parse(string);

        document.getElementById('inputString').value = JSON.stringify(this.changeLog);

        for (var key in this.changeLog) {
            if (this.changeLog.hasOwnProperty(key)) {

                if (!this.changeLog[key].color2 || this.changeLog[key].color2 == '' || this.changeLog[key].color1 == this.changeLog[key].color2) {
                    document.getElementById(key).style.background = this.changeLog[key].color1;
                } else {
                    document.getElementById(key).style.background = 'linear-gradient(' + this.changeLog[key].degrees + 'deg, ' + this.changeLog[key].color1 + ' 50%, ' + this.changeLog[key].color2 + ' 50%)';
                }

                if (this.changeLog[key].icon) {
                    document.getElementById(key).innerHTML = this.changeLog[key].icon;
                }
            }
        }
    }
    function renderPointsTable() {
        var pointTools = document.getElementById('pointsTools');
        var table = document.createElement('table');

        var headerRow = document.createElement('tr');
        var tableHeader1 = document.createElement('th');
        tableHeader1.innerHTML = 'Power';
        headerRow.appendChild(tableHeader1);

        this.powerNames.forEach(function(e) {
            var tableHeader = document.createElement('th');

            var name = Object.keys(e)[0];
            tableHeader.innerHTML = name;
            headerRow.appendChild(tableHeader);
        });

        table.appendChild(headerRow);

        for (var i = 0; i < 3; i++){

            var newRow = document.createElement('tr');
            var tableHeader2 = document.createElement('th');
            if (i == 0) {
                tableHeader2.innerHTML = '1st Age - Land';
            }
            else if (i == 1) {
                tableHeader2.innerHTML = '2nd Age - Races';
            }
            else if (i == 2) {
                tableHeader2.innerHTML = '3rd Age - Relations';
            }

            newRow.appendChild(tableHeader2);

            this.powerNames.forEach(function(e) {
                var name = Object.keys(e)[0];
                var pointArray = e[name];
                var cell1 = document.createElement('td');
                cell1.innerHTML = pointArray[i];
                newRow.appendChild(cell1);

                table.appendChild(newRow);
            });
        }

        pointTools.appendChild(table);
    }
    /*
    function renderPointsTable2() {
        var pointTools = document.getElementById('pointsTools');
        var table = document.createElement('table');

        var headerRow = document.createElement('tr');
        var tableHeader1 = document.createElement('th');
        tableHeader1.innerHTML = 'Power';
        var tableHeader2 = document.createElement('th');
        tableHeader2.innerHTML = '1st Age - Land';
        var tableHeader3 = document.createElement('th');
        tableHeader3.innerHTML = '2nd Age - Races';
        var tableHeader4 = document.createElement('th');
        tableHeader4.innerHTML = '3rd Age - Relations';

        headerRow.appendChild(tableHeader1);
        headerRow.appendChild(tableHeader2);
        headerRow.appendChild(tableHeader3);
        headerRow.appendChild(tableHeader4);
        table.appendChild(headerRow);

        this.powerNames.forEach(function(e) {
            var name = Object.keys(e)[0];
            var newRow = document.createElement('tr');
            var cell1 = document.createElement('td');
            cell1.innerHTML = name;
            newRow.appendChild(cell1);

            var pointValues = e[name];
            pointValues.forEach(function(f) {
                var cell2 = document.createElement('td');
                cell2.innerHTML = f;
                newRow.appendChild(cell2);
            });

            table.appendChild(newRow);
        });

        pointTools.appendChild(table);
    }
    */
    function renderTableGrid() {
        var gridArea = document.getElementById('grid');
        var table = document.createElement('table');
        table.setAttribute('id', 'gridTable');
        table.setAttribute('cellspacing', '0 px');
        table.setAttribute('cellpadding', '0 px');
        table.style.minWidth = this.columnCount * 40 + 'px';
        var headerRow = document.createElement('tr');
        headerRow.appendChild(document.createElement('th'));

        for (var i = 0; i < this.columnCount; i++){
            var tableHeader = document.createElement('th');
            tableHeader.innerHTML = this.columnNames[i];

            headerRow.appendChild(tableHeader);
            table.appendChild(headerRow);
        }

        for (var i = 1; i <= this.rowCount; i++){
            var newRow = document.createElement('tr');
            var cell = document.createElement('td');
            cell.innerHTML = i;
            newRow.appendChild(cell);

            for (var j = 0; j < this.columnCount; j++){
                var newCell = document.createElement('td');
                var coords = this.columnNames[j] + ',' + i;
                newCell.setAttribute('id', coords);
                newCell.setAttribute('onClick', "addToCell('" + coords + "')");

                newRow.appendChild(newCell);
            }

            table.appendChild(newRow);

        }

        displayCurrentToolset();
        document.getElementById('columnString').value = this.columnCount;
        document.getElementById('rowString').value = this.rowCount;

        if (gridArea.childNodes[0]) {
            gridArea.removeChild(gridArea.childNodes[0]);

        }
        gridArea.appendChild(table);

        readURL(document.getElementById('map'));


    }

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                document.getElementById('gridTable').setAttribute('background', e.target.result);
                document.getElementById('gridTable').style.width = 'auto';
                document.getElementById('gridTable').style.height = 'auto';
            };

            reader.readAsDataURL(input.files[0]);
        } else {
            document.getElementById('gridTable').setAttribute('background', 'https://zykehybrix.github.io/DawnOfWorlds/Map.jpg');
            document.getElementById('gridTable').style.width = 'auto';
            document.getElementById('gridTable').style.height = 'auto';
        }
    }

    renderPointsTable();
    renderTableGrid();
</script>
</body>
</html>
